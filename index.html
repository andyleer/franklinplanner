<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Franklin Planner Layout</title>

<style>
/* ============ GLOBAL ============ */
body {
    background: #f5f7f6;
    font-family: "Franklin Gothic Medium", "Arial Narrow", Arial, sans-serif;
    color: #003b3b;
    margin: 0;
}

/* Top controls */
.controls {
    text-align: center;
    padding: 0.75rem 0 0;
}
.controls button {
    font-size: 0.8rem;
    padding: 0.25rem 0.8rem;
    border-radius: 4px;
    border: 1px solid #305f5f;
    background: #e3f2f1;
    color: #003b3b;
    cursor: pointer;
}
.controls button:hover {
    background: #d4e9e7;
}

/* Spread – holds left + right pages */
.spread {
    display: flex;
    justify-content: center;
    align-items: flex-start;
    gap: 1rem;
    padding: 1rem;
}

/* Stacked layout */
.spread.stacked {
    flex-direction: column;
    align-items: center;
}

/* ============================
     PAGE – STATIC SIZE
   ============================ */
.page {
    width: 540px;
    height: 750px;
    background: #e9f1f0;
    border: 1px solid #cad7d5;
    border-radius: 6px;
    padding: 1.25rem 1.75rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    box-sizing: border-box;
    overflow: hidden;
    display: flex;
    flex-direction: column;
}

/* ============================
     PAGE BODY (2 columns)
   ============================ */
.page-body {
    display: grid;
    grid-template-columns: 1.2fr 1.2fr;
    height: 100%;
    gap: 1.6rem;
}

/* Left + Right column containers */
.left-column,
.right-column {
    height: 100%;
    display: flex;
    flex-direction: column;
}

/* -------------------------------------------------
   DATE BLOCK + CURRENT MONTH CALENDAR ROW
   ------------------------------------------------- */
.date-calendar-row {
    display: grid;
    grid-template-columns: 0.4fr 0.6fr;
    gap: 1rem;
    margin-bottom: 0.5rem;
}

/* ==== DATE BLOCK ==== */
.date-row {
    display: flex;
    align-items: flex-start;
    gap: 0.7rem;
}

.day-number {
    font-size: 2.8rem;
    font-weight: 700;
    line-height: 1;
}

.weekday {
    font-size: 1rem;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    margin-top: 0.25rem;
}

.month-year {
    font-size: 0.85rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: #305f5f;
}

.date-picker-label {
    font-size: 0.75rem;
    margin-top: 0.25rem;
    color: #4e7170;
}
.date-picker-label input {
    font-size: 0.75rem;
    padding: 0.1rem 0.3rem;
    border-radius: 3px;
    border: 1px solid #b0c4c3;
}

/* -------------------------------------------------
   MINI CALENDARS
   ------------------------------------------------- */
#mini-current {
    width: 90%;
    background: #ffffff;
    border: 1px solid #c4d1ce;
    border-radius: 4px;
    padding: 0.1rem;
    font-size: 0.75rem;
}

.mini-cal-title {
    text-align: center;
    font-weight: bold;
    font-size: 0.8rem;
    margin-bottom: 0.2rem;
}

.mini-cal-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    font-size: 0.7rem;
}
.mini-cal-grid div {
    padding: 2px 0;
}
.weekday-label {
    font-weight: bold;
    color: #406060;
}

/* Smaller calendars */
.mini-calendar-row {
    display: flex;
    gap: 0.5rem;
    margin-bottom: .5rem;
}

.mini-calendar-small {
    flex: 1;
    background: #ffffff;
    border: 1px solid #c4d1ce;
    border-radius: 4px;
    padding: 0.25rem;
    font-size: 0.65rem;
}

.mini-calendar-small .mini-cal-grid {
    font-size: 0.6rem;
}

/* -------------------------------------------------
   ABC TASK LIST
   ------------------------------------------------- */
.section-title {
    padding-top: 20px;
    border-bottom: 1.5px solid #003b3b;
    padding-bottom: 0.2rem;
    margin-bottom: 0.4rem;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.08em;
}

.task-row {
    display: grid;
    grid-template-columns: 0.4fr 0.7fr 6fr;
    gap: 0.2rem;
    padding: 0.08rem 0;
    border-bottom: 0.5px solid #c3d2d0;
}
.task-row input[type="checkbox"] {
    width: 16px;
    height: 16px;
}
.task-row select {
    width: 180%;
    font-size: 0.75rem;
    padding: 0.05rem 0.1rem;
}
.task-desc input {
    width: 100%;
    border: none;
    background: transparent;
    font-size: 0.8rem;
    padding-left: 1rem;
}
.task-desc input:focus { outline: none; }

.small-btn {
    margin-top: 0.3rem;
    padding: 0.2rem 0.6rem;
    font-size: 0.75rem;
    border-radius: 3px;
    border: 1px solid #305f5f;
    color: #305f5f;
    background: transparent;
    cursor: pointer;
}
.small-btn:hover {
    background: rgba(48,95,95,0.08);
}

/* -------------------------------------------------
   DAILY TRACKER
   ------------------------------------------------- */
.tracker-section {
    margin-top: auto;
}

.tracker-wrapper {
    border: 1px solid #c3d2d0;
    background: repeating-linear-gradient(
        to bottom,
        #ffffff 0,
        #ffffff 18px,
        #c3d2d0 19px,
        #ffffff 20px
    );
}
.tracker-textarea {
    width: 100%;
    min-height: 170px;
    padding: 0.4rem;
    background: transparent;
    border: none;
    font-size: 0.8rem;
}
.tracker-textarea:focus { outline: none; }

/* -------------------------------------------------
   APPOINTMENT SCHEDULE
   ------------------------------------------------- */
.appt-list {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.appt-row {
    display: grid;
    grid-template-columns: 0.5fr auto;
    border-bottom: 0.5px solid #c3d2d0;
    padding: 0.1rem 0;
    flex: 1;
}

.appt-time {
    text-align: left;
    padding-right: 0.3rem;
    font-size: 0.8rem;
    font-weight: bold;
}

.appt-input {
    border: none;
    background: transparent;
    font-size: 0.8rem;
}

/* -------------------------------------------------
   RIGHT PAGE NOTES
   ------------------------------------------------- */
.right-page-title {
    font-size: 0.9rem;
    font-weight: 700;
    letter-spacing: 0.12em;
    border-bottom: 1.5px solid #003b3b;
    padding-bottom: 0.25rem;
    margin-bottom: 0.4rem;
}

.notes-wrapper {
    border: 1px solid #c3d2d0;
    height: 100%;
    background: repeating-linear-gradient(
        to bottom,
        #ffffff 0,
        #ffffff 18px,
        #c3d2d0 19px,
        #ffffff 20px
    );
}
.notes-textarea {
    width: 100%;
    height: 100%;
    padding: 0.5rem;
    background: transparent;
    border: none;
    font-size: 0.8rem;
    resize: none;
}

</style>
</head>
<body>

<!-- ====== LAYOUT TOGGLE ====== -->
<div class="controls">
    <button id="toggleLayout">Switch to Stacked View</button>
</div>

<div id="spread" class="spread">

<!-- LEFT PAGE -->
<div class="page">
    <div class="page-body">

        <!-- LEFT COLUMN -->
        <div class="left-column">

            <!-- DATE + LARGE CAL -->
            <div class="date-calendar-row">
                <div>
                    <div class="date-row">
                        <div class="day-number" id="day-number">15</div>
                        <div>
                            <div class="weekday" id="weekday">Tuesday</div>
                            <div class="month-year" id="month-year">April 2025</div>
                            <label class="date-picker-label">
                                Date:
                                <input type="date" id="date-input">
                            </label>
                        </div>
                    </div>
                </div>
                
            </div>

            <!-- PREV + NEXT SMALL CALS -->
            <div class="mini-calendar-row">
                <div id="mini-prev" class="mini-calendar-small"></div>
                <div id="mini-next" class="mini-calendar-small"></div>
            </div>

            <!-- ABC LIST -->
            <div class="section-title">ABC PRIORITIZED DAILY TASK LIST</div>
            <div id="task-list"></div>
            <button class="small-btn" id="add-task">+ Add Task</button>

            <!-- DAILY TRACKER -->
            <div class="tracker-section">
                <div class="section-title">DAILY TRACKER</div>
                <div class="tracker-wrapper">
                    <textarea class="tracker-textarea" id="tracker"></textarea>
                </div>
            </div>

        </div>

        <!-- RIGHT COLUMN -->
       <div class="right-column">
    <div id="mini-current"></div>
    <div class="section-title">APPOINTMENT SCHEDULE</div>
    <div class="appt-list">
        <div class="appt-row"><div class="appt-time">7</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">8</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">9</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">10</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">11</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">12</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">1</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">2</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">3</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">4</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">5</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">6</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">7</div><input class="appt-input"></div>
        <div class="appt-row"><div class="appt-time">8</div><input class="appt-input"></div>
    </div>

</div>

    </div>
</div>

<!-- RIGHT PAGE -->
<div class="page">
    <div class="right-page-title">NOTES</div>
    <div class="notes-wrapper">
        <textarea class="notes-textarea" id="notes"></textarea>
    </div>
</div>

</div>

<script>
/* =====================================================================
   1. Helper: Collect state from the page for saving
   ===================================================================== */
function collectPlannerState() {
    const tasks = [...document.querySelectorAll("#task-list .task-row")].map(row => ({
        checked: row.querySelector("input[type='checkbox']").checked,
        priority: row.querySelector("select").value,
        description: row.querySelector(".task-desc input").value
    }));

    const appointments = [...document.querySelectorAll(".appt-row")].map(row => ({
        time: row.querySelector(".appt-time").textContent.trim(),
        text: row.querySelector(".appt-input").value
    }));

    return {
        date: document.getElementById("date-input").value,
        tasks,
        tracker: document.getElementById("tracker").value,
        appointments,
        notes: document.getElementById("notes") ? document.getElementById("notes").value : ""
    };
}

/* =====================================================================
   2. SAVE to server
   ===================================================================== */
let saveTimer;
function saveEntryDebounced() {
    clearTimeout(saveTimer);
    saveTimer = setTimeout(saveEntry, 600); // Delay to avoid spamming server
}

async function saveEntry() {
    const data = collectPlannerState();

    try {
        const res = await fetch("/api/save", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });
        const json = await res.json();

        // Flash saved indicator
        if (json.status === "saved") showSavedIndicator();
    } catch (e) {
        console.error("Save error:", e);
    }
}

/* Saved Indicator */
function showSavedIndicator() {
    let el = document.getElementById("saved-indicator");
    if (!el) {
        el = document.createElement("div");
        el.id = "saved-indicator";
        el.textContent = "Saved";
        Object.assign(el.style, {
            position: "fixed",
            bottom: "20px",
            right: "20px",
            background: "#003b3b",
            color: "white",
            padding: "6px 12px",
            borderRadius: "6px",
            fontSize: "0.8rem",
            opacity: "0",
            transition: "opacity .3s"
        });
        document.body.appendChild(el);
    }
    el.style.opacity = "1";
    setTimeout(() => (el.style.opacity = "0"), 1200);
}

/* =====================================================================
   3. LOAD from server
   ===================================================================== */
async function loadEntry(dateStr) {
    try {
        const res = await fetch(`/api/load?date=${dateStr}`);
        const data = await res.json();

        // Tasks
        const list = document.getElementById("task-list");
        list.innerHTML = "";
        data.tasks.forEach(t => {
            const row = document.createElement("div");
            row.className = "task-row";
            row.innerHTML = `
                <input type="checkbox" ${t.checked ? "checked" : ""}>
                <select>
                    <option ${t.priority === "A" ? "selected" : ""}>A</option>
                    <option ${t.priority === "B" ? "selected" : ""}>B</option>
                    <option ${t.priority === "C" ? "selected" : ""}>C</option>
                </select>
                <div class="task-desc">
                    <input type="text" value="${t.description}">
                </div>
            `;
            list.appendChild(row);
        });

        if (data.tasks.length === 0) {
            for (let i = 0; i < 6; i++) addBlankTask();
        }

        // Tracker
        document.getElementById("tracker").value = data.tracker;

        // Appointments
        const appts = document.querySelectorAll(".appt-row");
        data.appointments.forEach((a, i) => {
            if (appts[i]) appts[i].querySelector(".appt-input").value = a.text;
        });

        // Notes
        if (document.getElementById("notes")) {
            document.getElementById("notes").value = data.notes;
        }

    } catch (e) {
        console.error("Load error:", e);
    }
}

/* Helper: Add blank task row */
function addBlankTask() {
    const list = document.getElementById("task-list");
    const row = document.createElement("div");
    row.className = "task-row";
    row.innerHTML = `
        <input type="checkbox">
        <select><option>A</option><option>B</option><option>C</option></select>
        <div class="task-desc"><input type="text"></div>
    `;
    list.appendChild(row);
}

/* =====================================================================
   4. Hook events for auto-save
   ===================================================================== */
function attachAutoSaveListeners() {
    document.body.addEventListener("input", saveEntryDebounced);
    document.body.addEventListener("change", saveEntryDebounced);
}

/* =====================================================================
   5. Date change handler
   ===================================================================== */
function onDateChange(e) {
    const date = e.target.value;
    updateHeader(date);
    loadEntry(date);
}

/* =====================================================================
   6. INITIALIZE PAGE
   ===================================================================== */
document.addEventListener("DOMContentLoaded", () => {
    const dateInput = document.getElementById("date-input");

    // Set today's date initially
    const today = new Date().toISOString().slice(0, 10);
    dateInput.value = today;

    updateHeader(today);  // existing function
    loadEntry(today);     // <-- load DB content for this date
    attachAutoSaveListeners();

    dateInput.addEventListener("change", onDateChange);

    // + Add Task button still works
    document.getElementById("add-task").addEventListener("click", () => {
        addBlankTask();
        saveEntryDebounced();
    });
});

/* =====================================================================
   Existing calendar rendering (unchanged)
   ===================================================================== */
function renderMiniCalendar(containerId, year, month) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";

    const title = document.createElement("div");
    title.className = "mini-cal-title";
    title.textContent = new Date(year, month).toLocaleString("default", {
        month: "long",
        year: "numeric"
    });

    const grid = document.createElement("div");
    grid.className = "mini-cal-grid";

    const weekdays = ["S","M","T","W","T","F","S"];
    weekdays.forEach(d => {
        const cell = document.createElement("div");
        cell.className = "weekday-label";
        cell.textContent = d;
        grid.appendChild(cell);
    });

    const first = new Date(year, month, 1);
    const last = new Date(year, month + 1, 0);

    for (let i = 0; i < first.getDay(); i++) {
        grid.appendChild(document.createElement("div"));
    }

    for (let day = 1; day <= last.getDate(); day++) {
        const div = document.createElement("div");
        div.textContent = day;
        grid.appendChild(div);
    }

    container.appendChild(title);
    container.appendChild(grid);
}

function renderAllCalendars(d) {
    const y = d.getFullYear();
    const m = d.getMonth();
    renderMiniCalendar("mini-current", y, m);
    renderMiniCalendar("mini-prev", y, m - 1);
    renderMiniCalendar("mini-next", y, m + 1);
}
</script>


</body>
</html>
